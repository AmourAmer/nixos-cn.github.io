import{_ as t,V as d,W as l,X as n,Y as a,Z as s,$ as i,D as r}from"./framework-be68ad9c.js";const c={},o=i(`<h1 id="渐进式了解" tabindex="-1"><a class="header-anchor" href="#渐进式了解" aria-hidden="true">#</a> 渐进式了解</h1><h2 id="nix-生态构成简述" tabindex="-1"><a class="header-anchor" href="#nix-生态构成简述" aria-hidden="true">#</a> Nix 生态构成简述</h2><p>Nix 生态主要由 Nix 表达式语言，NixOS，Nix 包管理器，Nixpkgs，NixOps，Hydra 构成。</p><table><thead><tr><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>Nix 表达式语言</td><td>Nix 表达式语言是一种函数式编程语言，用于描述软件包的构建过程、依赖关系和环境变量等信息。它支持函数定义、递归、模式匹配等特性，还支持嵌套语法，可描述复杂的依赖关系和构建过程。Nix 还支持原子事务，使得所有的包和环境都是原子的，不会相互影响。Nix 表达式语言可用于定义软件包和环境，也可用于描述系统配置。它是一种强大、灵活、可重复和可扩展的语言，用于管理软件包和环境。</td></tr><tr><td>NixOS</td><td>NixOS 是一种基于 Nix 包管理器的 Linux 发行版，具有高度可配置性、可重复性和安全性。它采用声明性配置，使用配置文件明确描述系统状态，使得配置更易于维护。NixOS 适用于需要高度可定制性的用例，如服务器和开发环境。</td></tr><tr><td>Nix 包管理器</td><td>Nix是跨平台的功能强大的包管理器，采用函数式编程思想描述依赖关系和多版本软件包管理，并提供一系列跨平台工具方便管理和部署。</td></tr><tr><td>NixOps</td><td>NixOps是基于NixOS的云部署管理工具，支持多云平台，提供简单的命令行接口，可创建、部署、升级和回滚NixOS。用户可通过编写Nix表达式自定义部署和配置，使其成为灵活、可扩展和可定制的工具。适合需要管理大型、复杂基础设施的组织。</td></tr><tr><td>Hydra</td><td>Hydra 是在 NixOS 中使用的 CI/CD 系统，它可以自动构建、测试和部署软件包，并决定是否发布和部署。Hydra 可以在不同环境下测试软件包，适用于开发、测试和部署任何类型的软件。</td></tr><tr><td>Nixpkgs</td><td>nixpkgs 是 Nix 软件包管理器的官方软件包集合，包含数以万计的软件包，并提供了构建、测试和部署工具，支持多平台和多架构，适用于开发、测试和部署各种类型的软件。</td></tr></tbody></table><h2 id="何谓-nix-channel" tabindex="-1"><a class="header-anchor" href="#何谓-nix-channel" aria-hidden="true">#</a> 何谓 nix-channel</h2><p><code>nix-channel</code> 既是一个命令行工具也是“软件源”的别称，这个“软件”可以是系统也可以是软件包仓库。为了尽量避免混淆，我们接下来统一使用“频道”代称“软件源”。</p><h3 id="命令行" tabindex="-1"><a class="header-anchor" href="#命令行" aria-hidden="true">#</a> 命令行</h3><p><code>nix-channel</code> 命令行工具的使用：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nix-channel <span class="token punctuation">{</span>--add url <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token parameter variable">--remove</span> name <span class="token operator">|</span> <span class="token parameter variable">--list</span> <span class="token operator">|</span> <span class="token parameter variable">--update</span> <span class="token punctuation">[</span>names…<span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token parameter variable">--rollback</span> <span class="token punctuation">[</span>generation<span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>看起来这个命令行工具提供的功能有：订阅频道，退订频道，列出频道，更新频道，还能回滚“生成”。</p><h3 id="官方提供的频道-nix-channels" tabindex="-1"><a class="header-anchor" href="#官方提供的频道-nix-channels" aria-hidden="true">#</a> 官方提供的频道（nix-channels）</h3>`,11),p={href:"https://channels.nixos.org/",target:"_blank",rel:"noopener noreferrer"},h=i(`<div class="hint-container tip"><p class="hint-container-title">默认订阅的频道</p><p>NixOS 默认订阅了官方频道 nixos，即使你安装完系统什么都不做，它们也是存在的：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> nix-channel <span class="token parameter variable">-list</span>  <span class="token comment"># 列出频道</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nixos https://nixos.org/channels/nixos22.11
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">注意</p><p>这里的 <code>nixos</code> 与 <code>https://nixos.org/channels/nixos22.11</code> 并不是并列的，前者是频道名，后面是被订阅的 URL。</p></div></div><p>请你尝试访问上面的 URL。正如我们所说，这是一个频道集合，根目录下的每一个子目录就代表一个频道，官方提供了若干个频道，这些频道功能和版本各异：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>2022/8/4 22:59:10               0.1 kB         nixos-21.11-aarch64
2022/8/2 23:24:22               0.1 kB         nixos-21.11-small
2023/1/3 23:39:40               0.1 kB         nixos-22.05
2023/1/3 22:43:29               0.1 kB         nixos-22.05-aarch64
2023/1/2 04:11:11               0.1 kB         nixos-22.05-small
2023/3/14 13:56:02              0.1 kB         nixos-22.11
2023/3/15 03:53:42              0.1 kB         nixos-22.11-small
2023/3/13 18:40:11              0.1 kB         nixos-unstable
2023/3/14 19:23:44              0.1 kB         nixos-unstable-small
2023/3/15 07:13:34              0.1 kB         nixpkgs-22.11-darwin
2023/3/14 20:36:26              0.1 kB         nixpkgs-unstable
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="项目结构" tabindex="-1"><a class="header-anchor" href="#项目结构" aria-hidden="true">#</a> 项目结构</h3><p>我们以官方频道 <code>nixpkgs-unstable</code> 为例，查看每个频道大致的构成。它们似乎都提供了 <code>nixexprs.tar.xz</code>，从文件名我们就了解到这是一个包含了若干 nix 文件的 tar 压缩档案（Tarball）。</p><div class="hint-container tip"><p class="hint-container-title">Tarball</p><p>Taball 是 <code>tar</code> 文件格式的全称，不是 Nix 独有。它可以将多个文件打包在一起。如果你想在打包的时候压缩一下，还可以使用 gzip，bzip2 等软件压缩该档案。</p></div><p>于是我们解压它，列出目录树：</p><div class="language-powershell line-numbers-mode" data-ext="powershell"><pre class="language-powershell"><code>├─<span class="token punctuation">.</span>github
├─doc
├─lib
├─maintainers
├─nixos
└─pkgs
    ├─applications
    │  ├─accessibility
    │  │  ├─contrast
    │  │  └─wvkbd
    │  ├─audio
    │  │  ├─a2jmidid
    │  │  ├─ario
    │  │  ├─csound
    │  │  │  ├─csound-manual
    │  │  │  └─csound-qt
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container note"><p class="hint-container-title">仅供演示</p><p>以上目录树是笔者删减过的部分，实际构成肯定有差别。</p></div><p>上面的每个子目录中都有一个 <code>default.nix</code> 文件，这是导入该目录时默认被求值的文件。每个包名文件夹下面的 nix 文件，都是对于该软件包的描述。</p>`,10),u={class:"hint-container tip"},v=n("p",{class:"hint-container-title"},"提示",-1),x={href:"https://nixos-cn.org/guide/lang/",target:"_blank",rel:"noopener noreferrer"},b=i(`<p>每个频道都应该提供一个名为 <code>nixexprs</code> 的 Tarball。其中 <code>default.nix</code> 既是根目录也是每一级目录的入口点。</p><h2 id="nixpkgs" tabindex="-1"><a class="header-anchor" href="#nixpkgs" aria-hidden="true">#</a> Nixpkgs</h2><p>它是一个软件包集合，或者也可以被称为软件仓库？正如其他发行版一样，不同的系统版本对应了不同的软件包仓库，但是有人更加偏爱在 Release 的系统版本中使用 <code>nixpkgs-unstable</code> 软件频道，因为它们提供的包又多又新。</p><h3 id="订阅官方的-nixpkgs-unstable-频道" tabindex="-1"><a class="header-anchor" href="#订阅官方的-nixpkgs-unstable-频道" aria-hidden="true">#</a> 订阅官方的 nixpkgs-unstable 频道</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nix-channel <span class="token parameter variable">--add</span> https://nixos.org/channels/nixpkgs-unstable  <span class="token comment"># 添加频道，不过我更喜欢称它为 “订阅”</span>
nix-channel <span class="token parameter variable">--update</span>  <span class="token comment"># 更新频道</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如此，你便订阅上了官方的 nixpkgs-unstable 软件源。</p><div class="hint-container warning"><p class="hint-container-title">自定义频道名</p><p>默认情况下，频道名是截取自 URL 的最后一级：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nix-channel <span class="token parameter variable">--add</span> https://URL/nixpkgs-unstable
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>我们列出频道名：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nixpkgs-unstable https://URL/nixpkgs-unstable
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果我们需要手动命名频道，增加一个参数即可：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nix-channel <span class="token parameter variable">--add</span> https://URL/nixpkgs-unstable nixpkgs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h3 id="使用镜像频道" tabindex="-1"><a class="header-anchor" href="#使用镜像频道" aria-hidden="true">#</a> 使用镜像频道</h3><p>由于不可抗力的因素，大陆对于环大陆主机的访问显得异常艰难，所以我们需要使用国内的镜像频道来加速我们的访问（镜像频道通常由大学和企业公益性提供），下面列出了一些在中国可用的一些镜像频道：</p>`,9),m={href:"https://mirrors.tuna.tsinghua.edu.cn/help/nix-channels/",target:"_blank",rel:"noopener noreferrer"},g={href:"https://mirrors.ustc.edu.cn/help/nix-channels.html",target:"_blank",rel:"noopener noreferrer"},k={href:"https://sjtug.org/post/mirror-help/nix-channels/",target:"_blank",rel:"noopener noreferrer"},_=i(`<p>我们使用清华大学的镜像源作订阅演示：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nix-channel <span class="token parameter variable">--add</span> https://mirrors.tuna.tsinghua.edu.cn/nix-channels/nixpkgs-unstable nixpkgs  <span class="token comment"># 订阅频道，并分配 nixpkgs 命名</span>
nix-channel <span class="token parameter variable">--update</span>  <span class="token comment"># 更新频道</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container note"><p class="hint-container-title">注</p><p>特地修改频道名是因为许多表达式都会把 nixpkgs 而不是 nixpkgs-unstable 作输入。</p></div><h2 id="什么是二进制构建缓存" tabindex="-1"><a class="header-anchor" href="#什么是二进制构建缓存" aria-hidden="true">#</a> 什么是二进制构建缓存</h2><h2 id="如何更换镜像源" tabindex="-1"><a class="header-anchor" href="#如何更换镜像源" aria-hidden="true">#</a> 如何更换镜像源</h2><h2 id="如何升级-nixos-版本" tabindex="-1"><a class="header-anchor" href="#如何升级-nixos-版本" aria-hidden="true">#</a> 如何升级 NixOS 版本</h2><p>NixOS 并不是 ArchLinux 那样的滚动发行版，所以需要定期更迭系统版本来获取最新的支持。</p>`,7);function N(f,B){const e=r("ExternalLinkIcon");return d(),l("div",null,[o,n("p",null,[a("官方提供了"),n("a",p,[a("官方频道集合"),s(e)]),a("。订阅了其中的频道以后，就会从该频道获取包仓库或系统镜像的更新。")]),h,n("div",u,[v,n("p",null,[a("如果你还没有学习过 Nix 表达式语言，大抵是看不懂的，你可以前往 "),n("a",x,[a("Nix 语言概览"),s(e)]),a(" 进行初步学习。")])]),b,n("ul",null,[n("li",null,[n("a",m,[a("清华大学"),s(e)])]),n("li",null,[n("a",g,[a("中国科技大学"),s(e)])]),n("li",null,[n("a",k,[a("上海交通大学"),s(e)])])]),_])}const S=t(c,[["render",N],["__file","faq.html.vue"]]);export{S as default};
